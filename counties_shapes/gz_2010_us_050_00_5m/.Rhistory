# initialize libraries
library(shiny)
library(plyr)
library(dplyr)
library(ggplot2)
library(rgdal)    # for readOGR(...)
library(data.table)
library(mapproj)
# move up one directory
setwd("..")
#import some data
# Note, you have to delete the comments at the end of the text files.
# due to supression, the totals likely won't be able to be calculated when
# you include segments.
natality<- read.delim("wonder_data_extracts/Natality_13_15_race_age_v2.txt",
header = TRUE, colClasses = "character")
#total county rates
natality_counties<- read.delim("wonder_data_extracts/Natality_2015_county_totals_v2.txt",
header = TRUE, colClasses = "character")
head(natality_counties)
#total county rates
natality_counties<- read.delim("wonder_data_extracts/Natality_2015_county_totals_v2.txt",
header = TRUE, colClasses = "character") %>%
filter(Births != "Suppressed")
#total county rates
natality_counties<- read.delim("wonder_data_extracts/Natality_2015_county_totals_v2.txt",
header = TRUE, colClasses = "character") %>%
filter(Births != "Suppressed") %>%
mutate(Births = as.numeric(Births))
str(natality_counties)
# county and FIPS codes from https://www.census.gov/geo/reference/codes/cou.html
counties<- read.delim("national_county.txt", header = FALSE, sep = ",",
colClasses = "character")
counties_2<- counties %>%
rename_("state_code" = "V1",
"fips_state" = "V2",
"fips_county" = "V3",
"county_name" = "V4",
"fips_class" = "V5") %>%
mutate(fips = paste0(fips_state, fips_county))
# following stack overflow example
setwd("./counties_shapes/gz_2010_us_050_00_5m")
US.counties <- readOGR(dsn=".",layer="gz_2010_us_050_00_5m")
#leave out AK, HI, and PR (state FIPS: 02, 15, and 72)
US.counties <- US.counties[!(US.counties$STATE %in% c("02","15","72")),]
county.data <- US.counties@data
county.data <- cbind(id=rownames(county.data),county.data)
county.data <- data.table(county.data)
county.data[,FIPS:=paste0(STATE,COUNTY)] # this is the state + county FIPS code
setkey(county.data,FIPS)
natality.data <- data.table(natality_counties)
head(natality_counties)
setkey(natality.data,County.Code)
#total county rates
natality_counties<- read.delim("wonder_data_extracts/Natality_2015_county_totals_v2.txt",
header = TRUE, colClasses = "character") %>%
filter(Births != "Suppressed") %>%
mutate(Births = as.numeric(Births)) %>%
group_by(County.Code) %>%
mutate(cesarean_rate = Births/sum(Births))
